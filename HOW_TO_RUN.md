# 인증 시스템 추가 설명 및 실행 가이드

---

## 1. 인증 서버 (auth) 실행 방법 및 엔드포인트

### 인증 서버 역할
- 사용자 자격 증명 확인  
- OTP 생성 및 검증  
- OTP가 저장된 데이터베이스와 연동  

### 주요 엔드포인트 안내

| 경로          | HTTP 메서드 | 설명                                   |
|---------------|-------------|--------------------------------------|
| `/user/add`   | POST        | 테스트용 사용자 등록 (유저 추가)      |
| `/user/auth`  | POST        | 사용자 인증 및 OTP 생성 (SMS 전송은 생략) |
| `/otp/check`  | POST        | 입력된 OTP가 인증 서버에서 생성된 것인지 검증 |

### 실행 방법
1. auth 모듈을 빌드하고 실행하세요.  
2. `application.properties` 파일에서 데이터베이스 접속 정보를 본인의 환경에 맞게 설정해야 합니다.  
3. 서버가 정상 실행되면 위의 엔드포인트를 사용할 수 있습니다.

---

## 2. 비즈니스 서버 (business) 실행 방법 및 엔드포인트

### 실행 전 준비 사항
- 사용자 정보가 저장된 데이터베이스가 있어야 합니다.  
- 인증 서버와 비즈니스 서버가 모두 실행 중이어야 합니다.

### 인증 및 사용 흐름

1. **1차 로그인 요청**  
   - URL: `http://localhost:9090/login`  
   - HTTP 메서드: POST  
   - 요청 헤더에 `username`, `password` 값을 담아 전송  
   - 비즈니스 서버는 인증 서버와 연동해 자격 증명을 검증하고 OTP를 생성  
   - 생성된 OTP는 SMS 전송 없이 데이터베이스에 저장됩니다 (개발 및 테스트용)  

2. **2차 OTP 인증 요청**  
   - 동일한 URL(`http://localhost:9090/login`)  
   - POST  
   - 요청 헤더에 `username`과 OTP 코드(`code`)를 담아 전송  
   - OTP 검증 성공 시 JWT 토큰을 발급  

3. **보호된 리소스 접근**  
   - JWT 토큰을 HTTP 요청의 `Authorization` 헤더에 담아 서버에 전송  
   - 예: `http://localhost:9090/test` 엔드포인트 호출 시 인증된 사용자만 접근 가능  

---

## 3. 인증 시스템 아키텍처 및 인증 흐름 요약

### 시스템 구성 및 역할

| 구성 요소        | 역할                                                     |
|------------------|----------------------------------------------------------|
| **클라이언트**     | Postman 또는 실제 앱/웹 프론트엔드                         |
| **인증 서버 (auth)** | 사용자 ID/PW 인증, OTP 생성 및 검증, JWT 토큰 발급          |
| **비즈니스 서버 (business)** | JWT 토큰 검증 및 보호된 API 제공                      |

### 인증 절차 상세

| 단계    | 설명                                                                                                                                                         |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **1단계** | 사용자가 `username`과 `password`를 비즈니스 서버 `/login`에 요청 → 인증 서버가 자격 증명을 확인하고 OTP 생성 → OTP는 DB에 저장 (SMS 대신 DB에서 확인 가능)           |
| **2단계** | 사용자가 OTP 값을 `username`과 함께 다시 `/login`에 전송 → OTP 검증 후 성공하면 JWT 토큰 발급                                                                     |
| **3단계** | 클라이언트가 JWT 토큰을 `Authorization` 헤더에 포함해 보호된 리소스(예: `/test`)에 요청 → 인증된 사용자만 리소스에 접근 가능                                         |

---

## 4. 목표 및 참고 사항

- 단순 로그인 그 이상의 다중 인증(MFA) 시스템 설계 및 구현  
- OTP 발급 및 검증, JWT 기반 무상태(stateless) 인증 처리 완성  
- 인증 서버와 비즈니스 서버의 멀티 모듈 분리 및 연동 구조 이해  
- 실제 SMS 전송 기능은 생략했으나, 확장 시 SMS API 연동 가능  

---

> **Tip:**  
> 개발 환경에서 OTP는 SMS 대신 DB에서 직접 조회해 확인하세요.  
> JWT 토큰은 API 호출 시 `Authorization: Bearer <token>` 형식으로 헤더에 포함해야 정상 인증됩니다.
